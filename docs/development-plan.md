# Inkrement（日进）开发计划

> 配合 PRD v1.2 + Tech Spec v1.0 使用  
> 预计总工期：6 周（可根据实际情况调整）  
> 开发策略：**功能优先、本地验证、最后上线**

---

## 开发策略说明

> [!NOTE]
> **本地优先开发**：Phase 1-4 全部在本地开发和测试，不依赖远端服务器。  
> **免认证开发模式**：Phase 1-4 使用 Seed 测试用户自动登录，跳过短信验证，先跑通全部业务功能。  
> **最后上线**：Phase 5 统一完成认证系统 + 云端部署 + 域名配置。

---

## Phase 1：项目脚手架 + 核心链路（Week 1）

> 目标：本地开发环境就绪，AI 批改链路打通

### 1.1 项目初始化

- [x] 使用 `create-next-app` 初始化 Next.js 15 + TypeScript + Tailwind CSS + pnpm
- [ ] 安装并配置 shadcn/ui 组件库
- [x] 配置 ESLint
- [x] 配置 `.env` 模板（`.env.example`）

### 1.2 数据库

- [x] 创建 Prisma Schema（按 Tech Spec 第三章）
- [x] 执行数据库迁移（`prisma db push`）
- [x] 编写 Prisma Client 封装（`src/lib/db.ts`）
- [x] Seed 脚本：创建测试用户（1 学生 + 1 家长 + 1 管理员）

### 1.3 本地开发认证（临时方案）

- [x] 实现 Dev Auth Bypass：本地自动以 Seed 学生用户身份登录，无需短信
- [x] `src/lib/auth.ts` 提供 `getCurrentUser()` 方法，开发模式返回 Seed 用户
- [ ] 路由守卫 Middleware 判断 `NODE_ENV`，开发环境跳过认证

### 1.4 AI 抽象层

- [x] 实现 `AIProvider` 接口
- [x] 实现 `QwenProvider`（文本 + 结构化输出）
- [x] 实现 `QwenVLProvider`（视觉识别）
- [x] Prompt 模板目录结构 + 第一个写作批改 Prompt

### 1.5 基础 UI

- [x] 全局布局组件（Header + 底部导航栏 + 页面容器）
- [x] 设计色系 Token（Tailwind 配色方案）
- [x] 移动端适配基础验证

### Phase 1 完成标记

- [x] 本地 `pnpm dev` 可正常运行，页面可渲染
- [x] 自动以测试用户身份进入系统
- [ ] AI Provider 测试脚本可成功调用 Qwen API

---

## Phase 2：中文写作模块（Week 2）

> 目标：第一个完整功能闭环 — 出题 → 写作 → AI 批改 → 查看结果

### 2.1 训练计划

- [x] 每日任务自动生成逻辑（按周分配模块，每日一练）
- [x] 学生主页 Dashboard UI（今日任务卡片，动态加载）
- [ ] 连续打卡天数计算与展示

### 2.2 中文写作模块

- [x] AI 出题 API + Prompt（记叙文/描写文/读后感/议论文）+ 开发降级
- [x] 写作页面 UI（题目展示 + 文本输入 + 实时字数统计）
- [x] 草稿自动保存（localStorage，60s 间隔）
- [ ] 拍照上传组件（调用摄像头 / 相册 + 图片压缩）
- [ ] 图片上传 API（前端 → 阿里云 OSS 存储）
- [ ] OCR 识别 API（OSS 图片 URL → Qwen-VL → 文本回显）
- [x] 提交 + AI 批改 API（Qwen-Max 结构化输出）+ 开发降级
- [x] 批改结果展示页（总分动画 + 分项评分 + 详细点评 + 修改建议 + 示范改写）
- [x] 重新提交功能（修改后再次提交，保存新版本）
- [x] 历史版本切换查看

### Phase 2 完成标记

- [x] 本地可完成完整流程：打开主页 → 看到今日任务 → 做中文写作 → 收到 AI 批改
- [ ] 拍照上传 + OCR 识别 → 确认 → 提交 可正常工作
- [x] 重新提交后新版本覆盖旧成绩

---

## Phase 3：阅读模块 + 错题系统（Week 3-4）

> 目标：补全四大模块 + 错题闭环

### 3.1 古文阅读模块

- [x] 古文篇目展示 UI（原文 + 注释切换）
- [x] AI 题目生成（字词解释 + 句子翻译 + 内容理解）+ 开发降级
- [x] 答题页面 UI（逐题作答 + 题型标签）
- [x] AI 逐题批改 + 解析展示 + 开发降级
- [x] 重点字词列表展示（可折叠）

### 3.2 英文写作模块

- [x] AI 出题（双语题目 + 写作要求 + 推荐表达）+ 开发降级
- [x] 写作页面 UI（词数统计 + 草稿自动保存 + 推荐表达展示）
- [x] AI 批改 Prompt（语法错误标注 + 分项评分 + 示范段落）+ 开发降级
- [x] 批改结果展示（语法错误高亮 + 进度条 + 改进建议）

### 3.3 英文阅读模块

- [x] AI 生成阅读文章 + 5 道题目（选择/填空）+ 开发降级
- [x] 阅读页面 UI（文章 + 选择按钮 + 填空输入 + 生词切换）
- [x] AI 逐题批改 + 原文依据 + 开发降级
- [x] 生词表展示（音标 + 中文释义 + 例句）

### 3.4 错题系统

- [x] 错题记录逻辑（提交批改时自动记录错误到 WrongQuestion）
- [x] 错题本页面 UI（按模块筛选 + 错误次数 + 我的答案/正确答案对比）
- [x] 错题本 API（带模块统计）
- [ ] 错题复推逻辑（每日最多 2 道，附加在当日任务末尾）
- [ ] 出库条件判断（连续答对 2 次自动 archived）

### Phase 3 完成标记

- [x] 四大模块均可在本地完整运行（出题→作答→AI批改→查看结果）
- [x] 做错的题目自动出现在错题本中
- [ ] 下次同类训练日，错题作为附加项出现

---

## Phase 4：打卡记录 + 家长端 + 后台管理（Week 5）

> 目标：完善体验 + 管理后台（仍然全部本地测试）

### 4.1 打卡与记录

- [x] 打卡日历页面（月视图，已完成/未完成状态 + 模块颜色点）
- [x] 历史记录列表页（按时间倒序，模块筛选 + 分页 + 分数颜色）
- [x] 历史记录详情（跳转到对应模块 result 页面回看批改结果）
- [x] 成绩统计 API（各模块平均分/最高分 + 近 5 次 + 连续打卡天数）
- [x] 首页学习概览实时数据（连续打卡 + 本周完成 + 错题数）
- [x] 首页底部导航（日历 + 历史 + 错题本）

### 4.2 家长端

- [ ] 家长主页 UI
- [ ] 邀请码关联流程（学生展示邀请码 + 家长输入关联）
- [ ] 家长查看孩子打卡日历（只读）
- [ ] 家长查看训练详情（题目 + 提交 + AI 批改）
- [ ] 家长查看成绩趋势
- [ ] 家长查看错题本（只读）

### 4.3 后台管理 UI

- [ ] Admin 布局（侧边栏导航）
- [ ] 古文篇目管理（新增/编辑/删除/搜索/筛选）
- [ ] AI 模型配置页（下拉选择各模块模型 + API Key 配置）
- [ ] 用户管理页（用户列表 + 可重置密码）
- [ ] 训练数据统计页（完成次数、平均分等）
- [ ] Admin 权限校验 Middleware

### 4.4 古文篇目首批录入

- [ ] 整理并录入第一批约 20 篇预初教材核心篇目
- [ ] 通过后台管理 UI 验证 CRUD 功能

### Phase 4 完成标记

- [ ] 本地环境下，所有功能全部可用
- [ ] 学生、家长、管理员三个角色流程均已验证
- [ ] 折线图正确展示近期成绩趋势

---

## Phase 5：认证系统 + 部署上线（Week 6）

> 目标：替换开发模式临时认证 → 正式短信登录，部署到阿里云

### 5.1 短信认证系统

- [ ] 阿里云 SMS 短信发送封装（`src/lib/sms.ts`）
- [ ] 登录页 UI（手机号 + 验证码）
- [ ] 注册页 UI（选择角色 + 年级）
- [ ] NextAuth.js 自定义 Credentials Provider（替换 Dev Auth Bypass）
- [ ] 路由守卫 Middleware（正式版，未登录重定向到 /login）
- [ ] 验证码发送频率限制（60秒/次）
- [ ] 用户信息 API（`/api/auth/me`）

### 5.2 域名注册

- [ ] 注册域名（见 Tech Spec 附录：域名注册指南）
- [ ] 配置 DNS A 记录指向服务器 IP

### 5.3 阿里云部署

- [ ] 购买阿里云轻量服务器（香港 2C2G）
- [ ] 服务器环境配置（Node.js 20 + PM2 + Nginx）
- [ ] Let's Encrypt HTTPS 配置（Certbot）
- [ ] 上传 `.env` 生产环境配置
- [ ] SQLite 数据库迁移 + Seed 初始管理员
- [ ] GitHub Actions 自动部署流水线

### 5.4 整体打磨

- [ ] 移动端适配全面检查（所有页面）
- [ ] 加载状态 / 空状态 / 错误状态 UI
- [ ] 提交成功动效（confetti + 分数计数动画）
- [ ] 页面过渡动画
- [ ] SEO 基础（title / meta / 语义化 HTML）
- [ ] 安全检查（XSS / CSRF / API 限流）
- [ ] SQLite 数据库定期备份脚本

### Phase 5 完成标记

- [ ] 手机号注册 → 短信验证码登录 → 全流程正常
- [ ] 通过域名 HTTPS 可正常访问
- [ ] GitHub push 后自动部署
- [ ] 可正式交付给孩子日常使用

---

*— 文档结束 · Development Plan v1.0 —*
